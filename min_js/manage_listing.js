app.controller("manage_listing",["$scope","$http","$compile",function($scope,$http,$compile){function initAutocomplete(){autocomplete=new google.maps.places.Autocomplete(document.getElementById("address_line_1")),autocomplete.addListener("place_changed",fillInAddress)}function fillInAddress(){$scope.autocomplete_used=!0,fetchMapAddress(autocomplete.getPlace())}function initMap(){geocoder=new google.maps.Geocoder,map=new google.maps.Map(document.getElementById("map"),{center:{lat:parseFloat($("#latitude2").val()),lng:parseFloat($("#longitude2").val())},zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}}),$("<div/>").addClass("verify-map-pin").appendTo(map.getDiv()).click(function(){}),map.addListener("dragend",function(){geocoder.geocode({latLng:map.getCenter()},function(e,t){t==google.maps.GeocoderStatus.OK&&e[0]&&(fetchMapAddress(e[0]),$("#js-next-btn3").prop("disabled",!1))}),$(".verify-map-pin").removeClass("moving"),$(".verify-map-pin").addClass("unset")}),map.addListener("zoom_changed",function(){geocoder.geocode({latLng:map.getCenter()},function(e,t){t==google.maps.GeocoderStatus.OK&&e[0]&&fetchMapAddress(e[0])})}),map.addListener("drag",function(){$(".verify-map-pin").removeClass("unset"),$(".verify-map-pin").addClass("moving")})}function fetchMapAddress(e){console.log(e),"street_address"==e.types&&($scope.location_found=!0);var t={street_number:"short_name",route:"long_name",locality:"long_name",administrative_area_level_1:"long_name",country:"short_name",postal_code:"short_name"};$("#city").val(""),$("#state").val(""),$("#country").val(""),$("#address_line_1").val(""),$("#address_line_2").val(""),$("#postal_code").val("");var a=e;$scope.street_number="";for(var s=0;s<a.address_components.length;s++){var i=a.address_components[s].types[0];if(t[i]){var d=a.address_components[s][t[i]];if("street_number"==i&&($scope.street_number=d),"route"==i){var o=$scope.street_number+" "+d;$("#address_line_1").val($.trim(o))}"postal_code"==i&&$("#postal_code").val(d),"locality"==i&&$("#city").val(d),"administrative_area_level_1"==i&&$("#state").val(d),"country"==i&&$("#country").val(d)}}var n=($("#address_line_1").val(),a.geometry.location.lat()),l=a.geometry.location.lng();""==$("#address_line_1").val()?$("#js-next-btn").prop("disabled",!0):$("#js-next-btn").prop("disabled",!1),$scope.latitude=n,$scope.longitude=l}function upload(){upload2(),$(document).on("change","#upload_photos",function(){jQuery.ajaxFileUpload({url:"../../add_photos/"+$("#room_id").val(),secureuri:!1,fileElementId:"upload_photos",dataType:"json",async:!1,success:function(e){e.error_title?($("#js-error .panel-header").text(e.error_title),$("#js-error .panel-body").text(e.error_description),$(".js-delete-photo-confirm").addClass("hide"),$("#js-error").attr("aria-hidden",!1)):($scope.$apply(function(){$scope.photos_list=e,$("#photo_count").css("display","block"),$("#steps_count").text(e[0].steps_count),$scope.steps_count=e[0].steps_count}),$("#upload_photos").reset()),upload()}})})}function upload2(){$(document).on("change","#upload_photos2",function(){jQuery.ajaxFileUpload({url:"../../add_photos/"+$("#room_id").val(),secureuri:!1,fileElementId:"upload_photos2",dataType:"json",async:!1,success:function(e){e.error_title?($("#js-error .panel-header").text(e.error_title),$("#js-error .panel-body").text(e.error_description),$(".js-delete-photo-confirm").addClass("hide"),$("#js-error").attr("aria-hidden",!1)):($scope.$apply(function(){$scope.photos_list=e,$("#photo_count").css("display","block"),$("#steps_count").text(e[0].steps_count),$scope.steps_count=e[0].steps_count}),$("#upload_photos2").reset()),upload2()}})})}function photos_list(){$http.get("photos_list",{}).then(function(e){$scope.photos_list=e.data,e.data.length>0&&$("#photo_count").css("display","block")})}function calendar_edit_form(){$(".calendar-edit-form").removeClass("hide"),$(".selected").length>1?$(".calendar-edit-form > form > .panel-body").first().show():$(".calendar-edit-form > form > .panel-body").first().hide(),$(".selected").hasClass("status-b")?$scope.segment_status="not available":$scope.segment_status="available";var e=$(".first-day-selected").first().attr("id"),t=$(".last-day-selected").last().attr("id");$scope.calendar_edit_price=$("#"+e).find(".price > span:last").text(),$(".sidebar-price").val($scope.calendar_edit_price),$scope.notes=$("#"+e).find(".tile-notes-text").text(),$scope.isAddNote=""!=$scope.notes,$("#calendar-edit-start").datepicker({dateFormat:"dd-mm-yy",minDate:0,onSelect:function(e){var t=$("#calendar-edit-start").datepicker("getDate");$("#calendar-edit-end").datepicker("option","minDate",t),$("#calendar-edit-start").datepicker("option","maxDate",t),setTimeout(function(){$("#calendar-edit-end").datepicker("show")},20)}}),$("#calendar-edit-end").datepicker({dateFormat:"dd-mm-yy",minDate:1,onClose:function(){var e=$("#calendar-edit-start").datepicker("getDate"),t=$("#calendar-edit-end").datepicker("getDate");if($("#calendar-edit-end").datepicker("option","minDate",t),$("#calendar-edit-start").datepicker("option","maxDate",t),e>=t){var a=$("#calendar-edit-end").datepicker("option","minDate");$("#calendar-edit-end").datepicker("setDate",a)}}}),$("#calendar-edit-start").datepicker("setDate",change_format(e)),$("#calendar-edit-end").datepicker("setDate",change_format(t)),$("#calendar-edit-start").datepicker("option","maxDate",change_format(e)),$("#calendar-edit-end").datepicker("option","minDate",change_format(t))}function change_format(e){var t=e.split("-");return t[2]+"-"+t[1]+"-"+t[0]}$(document).on("click",'[data-track="welcome_modal_finish_listing"]',function(){var e={};e.started="Yes";var t=JSON.stringify(e);$http.post("update_rooms",{data:t}).then(function(e){$(".welcome-new-host-modal").attr("aria-hidden","true")})}),$(document).on("change",'[id^="basics-select-"], [id^="select-"]',function(){var e={};e[$(this).attr("name")]=$(this).val();var t=JSON.stringify(e),a=$(this).attr("data-saving");$("."+a+" h5").text("Saving..."),$("."+a).fadeIn(),$http.post("update_rooms",{data:t}).then(function(e){if("true"==e.data.success&&($("."+a+" h5").text("Saved!"),$("."+a).fadeOut(),$("#steps_count").text(e.data.steps_count),$scope.steps_count=e.data.steps_count),""!=$scope.beds&&""!=$scope.bedrooms&&""!=$scope.bathrooms&&""!=$scope.bed_type){var t=a.substring(0,a.length-1);$('[data-track="'+t+'"] a div div .transition').removeClass("visible"),$('[data-track="'+t+'"] a div div .transition').addClass("hide"),$('[data-track="'+t+'"] a div div .pull-right .nav-icon').removeClass("hide")}}),"beds"==$(this).attr("name")&&""!=$(this).val()&&$("#beds_show").show()}),$(document).on("blur",'[class^="overview-"]',function(){var e={};e[$(this).attr("name")]=$(this).val();var t=JSON.stringify(e);""!=$(this).val()?($(".saving-progress h5").text("Saving..."),$(".saving-progress").fadeIn(),$(".name_required_msg").addClass("hide"),$(".summary_required_msg").addClass("hide"),$(".name_required").removeClass("invalid"),$(".summary_required").removeClass("invalid"),$http.post("update_rooms",{data:t}).then(function(e){"true"==e.data.success&&($(".saving-progress h5").text("Saved!"),$(".saving-progress").fadeOut(),$("#steps_count").text(e.data.steps_count),$scope.steps_count=e.data.steps_count),""!=$scope.name&&""!=$scope.summary&&($('[data-track="description"] a div div .transition').removeClass("visible"),$('[data-track="description"] a div div .transition').addClass("hide"),$('[data-track="description"] a div div div .icon-ok-alt').removeClass("hide"))})):("name"==$(this).attr("name")?($(".name_required").addClass("invalid"),$(".name_required_msg").removeClass("hide")):($(".summary_required").addClass("invalid"),$(".summary_required_msg").removeClass("hide")),$('[data-track="description"] a div div .transition').removeClass("hide"),$('[data-track="description"] a div div .transition .icon').removeClass("hide"),$('[data-track="description"] a div div div .icon-ok-alt').addClass("hide"),$('[data-track="description"] a div div div .icon-ok-alt').removeClass("visible"))}),$(document).on("click",".nav-item a, .next_step a, #calendar_edit_cancel",function(){if(""!=$(this).attr("href")){var e={},t='<div class="manage-listing-content-container" id="js-manage-listing-content-container"><div class="manage-listing-content-wrapper" style="height:100%;"><div class="manage-listing-content" id="js-manage-listing-content"><div><div class="row-space-top-6 basics-loading loading"></div></div></div></div></div>';$("#ajax_container").html(t),$http.post($(this).attr("href").replace("manage-listing","ajax-manage-listing"),{data:e}).then(function(e){$("#ajax_container").html($compile(e.data)($scope))});var a=window.location.href.split("/"),s=$(a).get(-1);$("#href_"+s).attr("href",window.location.href);var a=$(this).attr("href").split("/"),i=$(a).get(-1);return"calendar"!=i?$(".manage-listing-row-container").removeClass("has-collapsed-nav"):""!=$("#room_status").val()&&($(".manage-listing-row-container").addClass("has-collapsed-nav"),$("#js-manage-listing-nav").addClass("collapsed")),"calendar"!=s&&"calendar"!=i||$http.post($(this).attr("href").replace("manage-listing","ajax-header"),{}).then(function(e){$("#ajax_header").html($compile(e.data)($scope))}),$scope.step=i,window.history.pushState({path:$(this).attr("href")},"",$(this).attr("href")),!1}}),$(document).on("click","#show_long_term",function(){$("#js-long-term-prices").removeClass("hide"),$("#js-set-long-term-prices").addClass("hide")}),$(document).on("click","#js-add-address, #js-edit-address",function(){var e={};e.country=$scope.country,e.address_line_1=$scope.address_line_1,e.address_line_2=$scope.address_line_2,e.city=$scope.city,e.state=$scope.state,e.postal_code=$scope.postal_code,e.latitude=$scope.latitude,e.longitude=$scope.longitude;var t=JSON.stringify(e);$("#js-address-container").addClass("enter_address"),$("#address-flow-view .modal").fadeIn(),$("#address-flow-view .modal").attr("aria-hidden","false"),$http.post(window.location.href.replace("manage-listing","enter_address"),{data:t}).then(function(e){$("#js-address-container").html($compile(e.data)($scope)),initAutocomplete()})}),$(document).on("click","#js-next-btn",function(){var e={};e.country=$scope.country=$("#country").val(),e.address_line_1=$scope.address_line_1=$("#address_line_1").val(),e.address_line_2=$scope.address_line_2=$("#address_line_2").val(),e.city=$scope.city=$("#city").val(),e.state=$scope.state=$("#state").val(),e.postal_code=$scope.postal_code=$("#postal_code").val(),e.latitude=$scope.latitude,e.longitude=$scope.longitude;var t=JSON.stringify(e);$scope.autocomplete_used||($scope.location_found=!0),$("#js-address-container .panel").addClass("loading"),$http.post(window.location.href.replace("manage-listing","location_not_found"),{data:t}).then(function(e){$("#js-address-container .panel").removeClass("loading"),$("#js-address-container").addClass("location_not_found"),$("#js-address-container").html($compile(e.data)($scope))})}),$(document).on("click","#js-next-btn2",function(){var e={};e.country=$scope.country,e.address_line_1=$scope.address_line_1,e.address_line_2=$scope.address_line_2,e.city=$scope.city,e.state=$scope.state,e.postal_code=$scope.postal_code,e.latitude=$scope.latitude,e.longitude=$scope.longitude;var t=JSON.stringify(e);$("#js-address-container .panel").addClass("loading"),$http.post(window.location.href.replace("manage-listing","verify_location"),{data:t}).then(function(e){$("#js-address-container .panel").removeClass("loading"),$("#js-address-container").addClass("location_not_found"),$("#js-address-container").html($compile(e.data)($scope)),setTimeout(function(){initMap()},100)})}),$(document).on("click","#js-next-btn3",function(){var e={};e.country=$scope.country=$("#country").val(),e.address_line_1=$scope.address_line_1=$("#address_line_1").val(),e.address_line_2=$scope.address_line_2=$("#address_line_2").val(),e.city=$scope.city=$("#city").val(),e.state=$scope.state=$("#state").val(),e.postal_code=$scope.postal_code=$("#postal_code").val(),e.latitude=$scope.latitude,e.longitude=$scope.longitude;var t=JSON.stringify(e);$("#js-address-container .panel:first").addClass("loading"),$http.post(window.location.href.replace("manage-listing","finish_address"),{data:t}).then(function(e){$("#js-address-container .panel").removeClass("loading"),$(".location-map-container-v2").removeClass("empty-map"),$(".location-map-container-v2").addClass("map-spotlight-v2"),$(".location-map-pin-v2").removeClass("moving"),$(".location-map-pin-v2").addClass("set"),$(".address-static-map img").remove(),$(".address-static-map").append('<img width="570" height="275" src="https://maps.googleapis.com/maps/api/staticmap?size=570x275&amp;center='+e.data.latitude+","+e.data.longitude+"&amp;zoom=15&amp;maptype=roadmap&amp;sensor=false&key="+map_key+'">'),$(".panel-body .text-center").remove(),$(".panel-body address").removeClass("hide"),$(".panel-body .js-edit-address-link").removeClass("hide");var t=""!=e.data.address_line_2?" / "+e.data.address_line_2:"";$(".panel-body address span:nth-child(1)").text(e.data.address_line_1+t),$(".panel-body address span:nth-child(2)").text(e.data.city+" "+e.data.state),$(".panel-body address span:nth-child(3)").text(e.data.postal_code),$(".panel-body address span:nth-child(4)").text(e.data.country_name),$('[data-track="location"] a div div .transition').removeClass("visible"),$('[data-track="location"] a div div .transition').addClass("hide"),$('[data-track="location"] a div div div .icon-ok-alt').removeClass("hide"),$("#address-flow-view .modal").fadeOut(),$("#address-flow-view .modal").attr("aria-hidden","true"),$("#steps_count").text(e.data.steps_count),$scope.steps_count=e.data.steps_count,$scope.location_found=!1})}),$(document).on("click",'.modal-close, [data-behavior="modal-close"], .panel-close',function(){$(".modal").fadeOut(),$(".tooltip").css("opacity","0"),$(".tooltip").attr("aria-hidden","true"),$(".modal").attr("aria-hidden","true")}),initAutocomplete(),$scope.location_found=!1,$scope.autocomplete_used=!1;var autocomplete;""==$("#address_line_1").val()&&$("#js-next-btn").prop("disabled",!0),$(document).on("click","#address_line_1",function(){""==$(this).val()?$("#js-next-btn").prop("disabled",!0):$("#js-next-btn").prop("disabled",!1)});var map,geocoder;$(document).on("click",'[name="amenities"]',function(){var e="";$('[name="amenities"]').each(function(){1==$(this).prop("checked")&&(e=e+$(this).val()+",")});var t=$(this).attr("data-saving");$("."+t+" h5").text("Saving..."),$("."+t).fadeIn(),$http.post("update_amenities",{data:e}).then(function(e){"true"==e.data.success&&($("."+t+" h5").text("Saved!"),$("."+t).fadeOut())})}),$(document).on("click","#photo-uploader",function(){$("#upload_photos").trigger("click")}),$(document).on("click","#js-photo-grid-placeholder",function(){$("#upload_photos2").trigger("click")}),upload(),jQuery.extend({handleError:function(e,t,a,s){e.error?e.error(t,a,s):t.responseText&&console.log(t.responseText)}}),jQuery.extend({createUploadIframe:function(e,t){var a="jUploadFrame"+e;if(window.ActiveXObject){var s=document.createElement("iframe");s.id=s.name=a,"boolean"==typeof t?s.src="javascript:false":"string"==typeof t&&(s.src=t)}else{var s=document.createElement("iframe");s.id=a,s.name=a}return s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",document.body.appendChild(s),s},createUploadForm:function(e,t){var a="jUploadForm"+e,s="jUploadFile"+e,i=jQuery('<form  action="" method="POST" name="'+a+'" id="'+a+'" enctype="multipart/form-data"></form>'),d=jQuery("#"+t),o=jQuery(d).clone();return jQuery(d).attr("id",s),jQuery(d).before(o),jQuery(d).appendTo(i),jQuery(i).css("position","absolute"),jQuery(i).css("top","-1200px"),jQuery(i).css("left","-1200px"),jQuery(i).appendTo("body"),i},ajaxFileUpload:function(e){e=jQuery.extend({},jQuery.ajaxSettings,e);var t=(new Date).getTime(),a=jQuery.createUploadForm(t,e.fileElementId),s=(jQuery.createUploadIframe(t,e.secureuri),"jUploadFrame"+t),i="jUploadForm"+t;e.global&&!jQuery.active++&&jQuery.event.trigger("ajaxStart");var d=!1,o={};e.global&&jQuery.event.trigger("ajaxSend",[o,e]);var n=function(t){var i=document.getElementById(s);try{i.contentWindow?(o.responseText=i.contentWindow.document.body?i.contentWindow.document.body.innerHTML:null,o.responseXML=i.contentWindow.document.XMLDocument?i.contentWindow.document.XMLDocument:i.contentWindow.document):i.contentDocument&&(o.responseText=i.contentDocument.document.body?i.contentDocument.document.body.innerHTML:null,o.responseXML=i.contentDocument.document.XMLDocument?i.contentDocument.document.XMLDocument:i.contentDocument.document)}catch(n){jQuery.handleError(e,o,null,n)}if(o||"timeout"==t){d=!0;var l;try{if(l="timeout"!=t?"success":"error","error"!=l){var r=jQuery.uploadHttpData(o,e.dataType);e.success&&e.success(r,l),e.global&&jQuery.event.trigger("ajaxSuccess",[o,e])}else jQuery.handleError(e,o,l)}catch(n){l="error",jQuery.handleError(e,o,l,n)}e.global&&jQuery.event.trigger("ajaxComplete",[o,e]),e.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop"),e.complete&&e.complete(o,l),jQuery(i).unbind(),setTimeout(function(){try{jQuery(i).remove(),jQuery(a).remove()}catch(t){jQuery.handleError(e,o,null,t)}},100),o=null}};e.timeout>0&&setTimeout(function(){d||n("timeout")},e.timeout);try{var a=jQuery("#"+i);jQuery(a).attr("action",e.url),jQuery(a).attr("method","POST"),jQuery(a).attr("target",s),a.encoding?a.encoding="multipart/form-data":a.enctype="multipart/form-data",jQuery(a).submit()}catch(l){jQuery.handleError(e,o,null,l)}return window.attachEvent?document.getElementById(s).attachEvent("onload",n):document.getElementById(s).addEventListener("load",n,!1),{abort:function(){}}},uploadHttpData:function(r,type){var data=!type;return data="xml"==type||data?r.responseXML:r.responseText,"script"==type&&jQuery.globalEval(data),"json"==type&&eval("data = "+data),"html"==type&&jQuery("<div>").html(data).evalScripts(),data}}),$scope.delete_photo=function(e,t){$("#js-error .panel-header").text("Delete Photo"),$("#js-error .panel-body").text("Are you sure you wish to delete this photo? It's a nice one!"),$(".js-delete-photo-confirm").removeClass("hide"),$("#js-error").attr("aria-hidden",!1),$(".js-delete-photo-confirm").attr("data-id",t);var a=$scope.photos_list.indexOf(e);$(".js-delete-photo-confirm").attr("data-index",a)},$(document).on("click",".js-delete-photo-confirm",function(){var e=$(this).attr("data-index");$http.post("delete_photo",{photo_id:$(this).attr("data-id")}).then(function(t){"true"==t.data.success&&($scope.photos_list.splice(e,1),$("#js-error").attr("aria-hidden",!0),$("#steps_count").text(t.data.steps_count),$scope.steps_count=t.data.steps_count)})}),$scope.$watch("photos_list",function(e){void 0!=$scope.photos_list&&(0!=$scope.photos_list.length?($('[data-track="photos"] a div div .transition').removeClass("visible"),$('[data-track="photos"] a div div .transition').addClass("hide"),$('[data-track="photos"] a div div div .icon-ok-alt').removeClass("hide")):($('[data-track="photos"] a div div .transition').removeClass("hide"),$('[data-track="photos"] a div div div .icon-ok-alt').addClass("hide")))}),$scope.$watch("steps_count",function(e){void 0!=$scope.steps_count&&(0==$scope.steps_count?($("#finish_step").hide(),$(".js-steps-remaining").addClass("hide"),$(".js-steps-remaining").removeClass("show"),$("#js-list-space-button").css("display",""),$("#js-list-space-tooltip").attr("aria-hidden","false"),$("#js-list-space-tooltip").css({opacity:"1",top:"290px"}),$("#js-list-space-tooltip").removeClass("animated").addClass("animated")):($("#finish_step").show(),$(".js-steps-remaining").removeClass("hide"),$(".js-steps-remaining").addClass("show"),$("#js-list-space-button").css("display","none"),$("#js-list-space-tooltip").attr("aria-hidden","true"),$("#js-list-space-tooltip").css({opacity:"0",top:"290px"})))}),$scope.over_first_photo=function(e){0==e&&$("#js-first-photo-text").removeClass("invisible")},$scope.out_first_photo=function(e){0==e&&$("#js-first-photo-text").addClass("invisible")},$scope.keyup_highlights=function(e,t){$http.post("photo_highlights",{photo_id:e,data:t}).then(function(e){})},$(document).on("change",'[id^="price-select-"]',function(){var e={};e[$(this).attr("name")]=$(this).val(),e.night=$("#price-night").val();var t=JSON.stringify(e),a=$(this).attr("data-saving");$("."+a+" h5").text("Saving..."),$("."+a).fadeIn(),$http.post("update_price",{data:t}).then(function(e){"true"==e.data.success?($('[data-error="price"]').text(""),$(".input-prefix").html(e.data.currency_symbol),$("."+a+" h5").text("Saved!"),$("."+a).fadeOut(),$("#steps_count").text(e.data.steps_count),$scope.steps_count=e.data.steps_count):($('[data-error="price"]').html(e.data.msg),$("."+a).fadeOut())})}),$(document).on("blur",'.autosubmit-text[id^="price-"]',function(){var e={};e[$(this).attr("name")]=$(this).val(),e.currency_code=$("#price-select-currency_code").val();var t=JSON.stringify(e),a=$(this).attr("data-saving");$("."+a+" h5").text("Saving..."),0!=$("#price-night").val()?($("."+a).fadeIn(),$http.post("update_price",{data:t}).then(function(e){"true"==e.data.success?($('[data-error="price"]').text(""),$(".input-prefix").html(e.data.currency_symbol),$("."+a+" h5").text("Saved!"),$("."+a).fadeOut(),$("#steps_count").text(e.data.steps_count),$scope.steps_count=e.data.steps_count):($('[data-error="price"]').html(e.data.msg),$("."+a).fadeOut()),0!=$("#price-night").val()&&($("#price-night-old").val($("#price-night").val()),$('[data-track="pricing"] a div div .transition').removeClass("visible"),$('[data-track="pricing"] a div div .transition').addClass("hide"),$('[data-track="pricing"] a div div div .icon-ok-alt').removeClass("hide"))})):0==$("#price-night-old").val()?($("#price-night").val($("#price-night-old").val()),$('[data-track="pricing"] a div div .transition').removeClass("hide"),$('[data-track="pricing"] a div div div .icon-ok-alt').addClass("hide")):($("#price-night").val($("#price-night-old").val()),$('[data-track="pricing"] a div div .transition').removeClass("visible"),$('[data-track="pricing"] a div div .transition').addClass("hide"),$('[data-track="pricing"] a div div div .icon-ok-alt').removeClass("hide"))}),$(document).on("change",'[id$="_checkbox"]',function(){if(0==$(this).prop("checked")){var e={},t=$(this).attr("id"),a='[data-checkbox-id="'+t+'"] > div > div > div > input';$(a).val(""),"price_for_extra_person_checkbox"==t&&($('[data-checkbox-id="'+t+'"] > div > div > #guests-included-select > div > select').val(1),e[$('[data-checkbox-id="'+t+'"] > div > div > #guests-included-select > div > select').attr("name")]=1),e[$(a).attr("name")]=$(a).val();var s=JSON.stringify(e),i=$(a).attr("data-saving");$("."+i+" h5").text("Saving..."),$("."+i).fadeIn(),$http.post("update_price",{data:s}).then(function(e){"true"==e.data.success&&($(".input-prefix").html(e.data.currency_symbol),$("."+i+" h5").text("Saved!"),$("."+i).fadeOut(),$("#steps_count").text(e.data.steps_count),$scope.steps_count=e.data.steps_count)})}}),$(document).on("click",'[id^="available-"]',function(){var e={},t=$(this).attr("data-slug");e.calendar_type=t.charAt(0).toUpperCase()+t.slice(1);var a=JSON.stringify(e);$(".saving-progress h5").text("Saving..."),$(".saving-progress").fadeIn(),$http.post("update_rooms",{data:a}).then(function(e){"true"==e.data.success&&($scope.selected_calendar=t,$('[data-slug="'+t+'"]').addClass("selected"),$(".saving-progress h5").text("Saved!"),$(".saving-progress").fadeOut(),$("#steps_count").text(e.data.steps_count),$scope.steps_count=e.data.steps_count),$('[data-track="calendar"] a div div .transition').removeClass("visible"),$('[data-track="calendar"] a div div .transition').addClass("hide"),$('[data-track="calendar"] a div div .pull-right .nav-icon').removeClass("hide")})}),$(document).on("mouseover",'[id^="available-"]',function(){$('[id^="available-"]').removeClass("selected")}),$(document).on("mouseout",'[id^="available-"]',function(){$('[id="available-'+$scope.selected_calendar+'"]').addClass("selected")});var ex_pathname=window.location.href.split("/");$scope.step=$(ex_pathname).get(-1),photos_list(),$(document).on("click","#finish_step",function(){$http.get("rooms_steps_status",{}).then(function(e){for(var t in e.data)if("0"==e.data[t])return $("#href_"+t).trigger("click"),!1})}),$(document).on("click","#js-list-space-button",function(){var e={};e.status="Listed";var t=JSON.stringify(e);$http.post("update_rooms",{data:t}).then(function(e){$http.get("rooms_data",{}).then(function(e){$("#symbol_finish").html(e.data.symbol),$scope.popup_photo_name=e.data.photo_name,$scope.popup_night=e.data.night,$scope.popup_room_name=e.data.name,$scope.popup_room_type_name=e.data.room_type_name,$scope.popup_property_type_name=e.data.property_type_name,$scope.popup_state=e.data.state,$scope.popup_country=e.data.country_name,$(".finish-modal").attr("aria-hidden","false"),$(".finish-modal").removeClass("hide")})})}),$(document).on("blur",'[id^="help-panel"] > textarea',function(){var e={},t=$(this).attr("name");e[t]=$(this).val();var a=JSON.stringify(e);$(".saving-progress h5").text("Saving..."),"neighborhood_overview"!=t&&"transit"!=t?$(".help-panel-saving").fadeIn():$(".help-panel-neigh-saving").fadeIn(),$http.post("update_description",{data:a}).then(function(e){"true"==e.data.success&&($(".saving-progress h5").text("Saved!"),"neighborhood_overview"!=t&&"transit"!=t?$(".help-panel-saving").fadeOut():$(".help-panel-neigh-saving").fadeOut())})}),$(document).on("click","#collapsed-nav",function(){$("#js-manage-listing-nav").hasClass("collapsed")?$("#js-manage-listing-nav").removeClass("collapsed"):$("#js-manage-listing-nav").addClass("collapsed")}),$(document).on("click",".month-nav",function(){var e=$(this).attr("data-month"),t=$(this).attr("data-year"),a={};a.month=e,a.year=t;var s=JSON.stringify(a);return $(".ui-datepicker-backdrop").removeClass("hide"),$(".spinner-next-to-month-nav").addClass("loading"),$http.post($(this).attr("href").replace("manage-listing","ajax-manage-listing"),{data:s}).then(function(e){$("#ajax_container").html($compile(e.data)($scope)),$(".spinner-next-to-month-nav").removeClass("loading"),$(".ui-datepicker-backdrop").addClass("hide")}),!1}),$(document).on("change","#calendar_dropdown",function(){var e=$(this).val(),t=e.split("-")[0],a=e.split("-")[1],s={};s.month=a,s.year=t;var i=JSON.stringify(s);return $(".ui-datepicker-backdrop").removeClass("hide"),$(".spinner-next-to-month-nav").addClass("loading"),$http.post($(this).attr("data-href").replace("manage-listing","ajax-manage-listing"),{data:i}).then(function(e){$(".ui-datepicker-backdrop").addClass("hide"),$(".spinner-next-to-month-nav").removeClass("loading"),$("#ajax_container").html($compile(e.data)($scope))}),!1}),$(document).on("click",".tile",function(){if(!$(this).hasClass("other-day-selected")&&!$(this).hasClass("selected")&&!$(this).hasClass("tile-previous")){var e=$(this).attr("id");$("#"+e).addClass("first-day-selected last-day-selected selected"),$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+e+"> .date");var t=($(this).index(),$(this).position().top+50),a=$(this).position().left,s=t,i=a+125;$(".days-container").append('<div><div style="left:'+a+"px;top:"+t+'px;" class="tile-selection-handle tile-handle-left"><div class="tile-selection-handle__inner"><span class="tile-selection-handle__ridge"></span><span class="tile-selection-handle__ridge"></span><span class="tile-selection-handle__ridge"></span></div></div></div><div><div style="left: '+i+"px; top: "+s+'px;" class="tile-selection-handle tile-handle-right"><div class="tile-selection-handle__inner"><span class="tile-selection-handle__ridge"></span><span class="tile-selection-handle__ridge"></span><span class="tile-selection-handle__ridge"></span></div></div></div>'),$(".tile").each(function(){e!=$(this).attr("id")&&$(this).addClass("other-day-selected")}),calendar_edit_form()}});var selected_li_status=0,direction="";$(document).on("mousedown",".tile-selection-handle",function(){selected_li_status=1,direction=$(this).hasClass("tile-handle-left")?"left":"right"});var oldx=0,oldy=0;$(document).on("mouseover",".tile",function(e){if(e.pageX>oldx&&"right"==direction){if(1==selected_li_status&&!$(this).hasClass("tile-previous")){var t=$(this).attr("id");$("#"+t).removeClass("other-day-selected"),$("#"+t).addClass("selected"),$("#"+$(this).attr("id")+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+$(this).attr("id")+"> .date");var a=$(".selected").last().index(),s=$(".selected").first().index();$("*").removeClass("first-day-selected last-day-selected"),$(".selected").first().addClass("first-day-selected"),$(".selected").last().addClass("last-day-selected");for(var i=s+1;a>=i;i++){var t=$(".days-container > .list-unstyled > li:nth-child("+i+")").attr("id");$("#"+t).addClass("selected"),$("#"+t).removeClass("other-day-selected"),$("#"+t+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+t+"> .date")}}}else if(e.pageX<oldx&&"right"==direction){if(1==selected_li_status&&!$(this).hasClass("tile-previous")){var t=$(".days-container > .list-unstyled > li:nth-child("+$(this).index()+")").next().next().attr("id"),d=$(".days-container > .list-unstyled > li:nth-child("+$(this).index()+")").next().attr("id");$("*").removeClass("first-day-selected last-day-selected"),$(".selected").first().addClass("first-day-selected"),$(".selected").last().addClass("last-day-selected"),$("#"+t).removeClass("selected"),$("#"+t).addClass("other-day-selected"),$(this).removeClass("selected"),$(this).addClass("other-day-selected"),$("#"+d+" > div.tile-selection-container").remove()}0==$(".selected").length&&(selected_li_status=0,$(".tile").each(function(){$(this).removeClass("other-day-selected last-day-selected first-day-selected"),$(".tile-selection-container").remove(),$(".tile-selection-handle").remove()}))}if(e.pageX>oldx&&"left"==direction){if(1==selected_li_status&&!$(this).hasClass("tile-previous")){var t=$(".days-container > .list-unstyled > li:nth-child("+$(this).index()+")").attr("id"),d=$(".days-container > .list-unstyled > li:nth-child("+$(this).index()+")").attr("id");$("*").removeClass("first-day-selected last-day-selected"),$(".selected").first().addClass("first-day-selected"),$(".selected").last().addClass("last-day-selected"),$("#"+t).removeClass("selected"),$("#"+t).addClass("other-day-selected"),$(this).removeClass("selected"),$(this).addClass("other-day-selected"),$("#"+d+" > div.tile-selection-container").remove()}}else if(e.pageX<oldx&&"left"==direction){if(1==selected_li_status&&!$(this).hasClass("tile-previous")){var t=$(".days-container > .list-unstyled > li:nth-child("+$(this).index()+")").next().next().attr("id"),d=$(".days-container > .list-unstyled > li:nth-child("+$(this).index()+")").next().attr("id");$("#"+t).addClass("selected"),$("#"+t).removeClass("other-day-selected"),$(this).addClass("selected"),$(this).removeClass("other-day-selected");for(var a=$(".selected").last().index(),s=$(".selected").first().index(),i=s+1;a>=i;i++){var t=$(".days-container > .list-unstyled > li:nth-child("+i+")").attr("id");$("#"+t).addClass("selected"),$("#"+t).removeClass("other-day-selected"),$("#"+t+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+t+"> .date"),$("#"+t).removeClass("first-day-selected last-day-selected")}$("*").removeClass("first-day-selected last-day-selected"),$(".selected").first().addClass("first-day-selected"),$(".selected").last().addClass("last-day-selected"),$("#"+t+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+t+"> .date");
}0==$(".selected").length&&(selected_li_status=0,$(".tile").each(function(){$(this).removeClass("other-day-selected last-day-selected first-day-selected"),$(".tile-selection-container").remove(),$(".tile-selection-handle").remove()}))}if(e.pageY>oldy&&"right"==direction&&1==selected_li_status&&!$(this).hasClass("tile-previous")){var t=$(this).attr("id");$("#"+t).removeClass("other-day-selected"),$("#"+t).addClass("selected"),$("#"+$(this).attr("id")+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+$(this).attr("id")+"> .date");var a=$(".selected").last().index(),s=$(".selected").first().index();$("*").removeClass("first-day-selected last-day-selected"),$(".selected").first().addClass("first-day-selected"),$(".selected").last().addClass("last-day-selected");for(var i=s+1;a>=i;i++){var t=$(".days-container > .list-unstyled > li:nth-child("+i+")").attr("id");$("#"+t).addClass("selected"),$("#"+t).removeClass("other-day-selected"),$("#"+t+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+t+"> .date")}}if(e.pageY<oldy&&"right"==direction&&1==selected_li_status&&!$(this).hasClass("tile-previous")&&!$(this).hasClass("selected")){var t=$(this).attr("id"),a=$(this).index(),s=$(".selected").first().index();$(".selected").addClass("other-day-selected"),$(".selected").removeClass("selected");for(var i=s+1;a+1>=i;i++){var t=$(".days-container > .list-unstyled > li:nth-child("+i+")").attr("id");$("#"+t).addClass("selected"),$("#"+t).removeClass("other-day-selected"),$("#"+t+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+t+"> .date")}$("*").removeClass("first-day-selected last-day-selected"),$(".selected").first().addClass("first-day-selected"),$(".selected").last().addClass("last-day-selected")}if(e.pageY<oldy&&"left"==direction&&1==selected_li_status&&!$(this).hasClass("tile-previous")){var t=$(this).attr("id");$("#"+t).removeClass("other-day-selected"),$("#"+t).addClass("selected"),$("#"+$(this).attr("id")+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+$(this).attr("id")+"> .date");var a=$(".selected").last().index(),s=$(".selected").first().index();$("*").removeClass("first-day-selected last-day-selected"),$(".selected").first().addClass("first-day-selected"),$(".selected").last().addClass("last-day-selected");for(var i=s+1;a>=i;i++){var t=$(".days-container > .list-unstyled > li:nth-child("+i+")").attr("id");$("#"+t).addClass("selected"),$("#"+t).removeClass("other-day-selected"),$("#"+t+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+t+"> .date")}}if(e.pageY>oldy&&"left"==direction&&1==selected_li_status&&!$(this).hasClass("tile-previous")&&!$(this).hasClass("selected")){var t=$(this).attr("id"),s=$(this).index(),a=$(".selected").last().index();$(".selected").addClass("other-day-selected"),$(".selected").removeClass("selected");for(var i=s+1;a+1>=i;i++){var t=$(".days-container > .list-unstyled > li:nth-child("+i+")").attr("id");$("#"+t).addClass("selected"),$("#"+t).removeClass("other-day-selected"),$("#"+t+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+t+"> .date")}$("*").removeClass("first-day-selected last-day-selected"),$(".selected").first().addClass("first-day-selected"),$(".selected").last().addClass("last-day-selected")}oldx=e.pageX,oldy=e.pageY}),$(document).on("mouseup",".tile-selection-handle, .tile",function(){selected_li_status=0;var e=$(".selected").last().attr("id"),t=$(".selected").first().attr("id");$("*").removeClass("first-day-selected last-day-selected"),$(".selected").first().addClass("first-day-selected"),$(".selected").last().addClass("last-day-selected");var a=$("#"+e).position(),s=$("#"+t).position(),i=s.top+50,d=s.left,o=a.top+50,n=a.left+125;$(".days-container > div > .tile-selection-handle:last").remove(),$(".days-container > div > .tile-selection-handle:first").remove(),$(".days-container").append('<div><div style="left:'+d+"px;top:"+i+'px;" class="tile-selection-handle tile-handle-left"><div class="tile-selection-handle__inner"><span class="tile-selection-handle__ridge"></span><span class="tile-selection-handle__ridge"></span><span class="tile-selection-handle__ridge"></span></div></div></div><div><div style="left: '+n+"px; top: "+o+'px;" class="tile-selection-handle tile-handle-right"><div class="tile-selection-handle__inner"><span class="tile-selection-handle__ridge"></span><span class="tile-selection-handle__ridge"></span><span class="tile-selection-handle__ridge"></span></div></div></div>'),calendar_edit_form()}),$scope.calendar_edit_submit=function(e){$http.post("calendar_edit",{status:$scope.segment_status,start_date:$("#calendar-edit-start").val(),end_date:$("#calendar-edit-end").val(),price:$scope.calendar_edit_price,notes:$scope.notes}).then(function(t){var a=$("#calendar_dropdown").val(),s=a.split("-")[0],i=a.split("-")[1],d={};d.month=i,d.year=s;var o=JSON.stringify(d);return $(".ui-datepicker-backdrop").removeClass("hide"),$(".spinner-next-to-month-nav").addClass("loading"),$http.post(e.replace("manage-listing","ajax-manage-listing"),{data:o}).then(function(e){$(".ui-datepicker-backdrop").addClass("hide"),$(".spinner-next-to-month-nav").removeClass("loading"),$("#ajax_container").html($compile(e.data)($scope))}),!1})},$(document).on("change","#availability-dropdown > div > select",function(){var e={};e.status=$(this).val();var t=JSON.stringify(e);$http.post("update_rooms",{data:t}).then(function(t){"Unlisted"==e.status?($("#availability-dropdown > i").addClass("dot-danger"),$("#availability-dropdown > i").removeClass("dot-success")):"Listed"==e.status&&($("#availability-dropdown > i").removeClass("dot-danger"),$("#availability-dropdown > i").addClass("dot-success"))})}),$(document).on("click","#export_button",function(){$("#export_popup").attr("aria-hidden","false")}),$(document).on("click","#import_button",function(){$("#import_popup").attr("aria-hidden","false")}),$scope.booking_select=function(e){var t={};t.booking_type=e;var a=JSON.stringify(t);$http.post("update_rooms",{data:a}).then(function(t){"true"==t.data.success&&($("#before_select").addClass("hide"),$("#"+e).removeClass("hide"))})},$scope.booking_change=function(e){var t={};t.booking_type="";var a=JSON.stringify(t);$http.post("update_rooms",{data:a}).then(function(t){"true"==t.data.success&&($("#before_select").removeClass("hide"),$("#"+e).addClass("hide"))})}}]);