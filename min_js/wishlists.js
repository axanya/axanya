app.controller("wishlists",["$scope","$http","$filter",function(i,t,o){function s(){var i={zoom:10,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("results_map"),i),e(map,locations)}function e(i,t){var o,s,e=new google.maps.LatLngBounds,l=new google.maps.InfoWindow;for(s=0;s<t.length;s++){var n=t[s].rooms.name,r=t[s].rooms.rooms_address.latitude,d=t[s].rooms.rooms_address.longitude,m=(t[s].rooms.rooms_address.city,APP_URL+"/images/"+t[s].rooms.photo_name),c=t[s].room_id,_=t[s].rooms.user_id,h=t[s].rooms_price.night,g=(t[s].rooms_price.currency_code,t[s].rooms_price.currency.symbol),p=(APP_URL+"/images/"+t[s].rooms.photo_name,t[s].rooms.booking_type);latlngset=new google.maps.LatLng(r,d);var w='<div id="info_window_'+c+'" class="listing listing-map-popover" data-price="'+g+'" data-id="'+c+'" data-user="'+_+'" data-url="/rooms/'+c+'" data-name="'+n+'" data-lng="'+d+'" data-lat="'+r+'"><div class="panel-image listing-img">';w+='<a class="media-photo media-cover" target="listing_'+c+'" href="'+APP_URL+"/rooms/"+c+'"><div class="listing-img-container media-cover text-center"><img id="marker_image_'+c+'" rooms_image = "" alt="'+n+'" class="img-responsive-height" data-current="0" src="'+m+'"></div></a>',w+='<div class="target-prev target-control block-link marker_slider"  data-room_id="'+c+'"><i class="icon icon-chevron-left icon-size-2 icon-white"></i></div><a class="link-reset panel-overlay-bottom-left panel-overlay-label panel-overlay-listing-label" target="listing_'+c+'" href="'+APP_URL+"rooms/"+c+'"><div>',instant_book="","instant_book"==p&&(instant_book='<span aria-label="Book Instantly" data-behavior="tooltip" class="h3 icon-beach"><i class="icon icon-instant-book icon-flush-sides"></i></span>'),w+='<sup class="h6 text-contrast">'+g+'</sup><span class="h3 text-contrast price-amount">'+h+'</span><sup class="h6 text-contrast"></sup>'+instant_book+'</div></a><div class="target-next target-control marker_slider block-link" data-room_id="'+c+'"><i class="icon icon-chevron-right icon-size-2 icon-white"></i></div></div>',w+='<div class="panel-body panel-card-section"><div class="media"><h3 class="h5 listing-name text-truncate row-space-top-1" itemprop="name" title="'+n+'">'+n+"</a></h3>";var o=new google.maps.Marker({map:i,title:w,position:latlngset,icon:a("normal")});e.extend(o.position),google.maps.event.addListener(o,"click",function(){l.setContent(this.title),l.open(i,this)})}i.fitBounds(e);var v=google.maps.event.addListener(i,"idle",function(){i.setZoom(3),google.maps.event.removeListener(v)})}function a(i){var t="map-pin-set-3460214b477748232858bedae3955d81.png";"hover"==i&&(t="hover-map-pin-set-3460214b477748232858bedae3955d81.png");var o=new google.maps.MarkerImage(APP_URL+"/images/"+t,new google.maps.Size(50,50),new google.maps.Point(0,0),new google.maps.Point(9,20));return o}$(".create").click(function(){$(".modal-transitions").removeClass("hide")}),$(".cancel").click(function(i){i.preventDefault(),$(".modal-transitions").addClass("hide"),i.preventDefault()}),$("#map").click(function(){$(".results-map").show(),$(".results-list").hide(),$("#map").prop("disabled",!0),$("#list").prop("disabled",!1),s()}),$("#list").click(function(){$(".results-list").show(),$(".results-map").hide(),$("#list").prop("disabled",!0),$("#map").prop("disabled",!1)}),$(document).on("click",".marker_slider",function(){var i=$(this).attr("data-room_id"),o=$("#marker_image_"+i+",#wishlist_image_"+i).attr("rooms_image"),s=$("#marker_image_"+i+",#wishlist_image_"+i).attr("src");if(""==$.trim(o))$(this).parent().addClass("loading"),t.post(APP_URL+"/rooms_photos",{rooms_id:i}).then(function(t){angular.forEach(t.data,function(i){o=""==$.trim(o)?i.name:o+","+i.name}),$("#marker_image_"+i+",#wishlist_image_"+i).attr("rooms_image",o);var e=s.split("rooms/"+i+"/"),a=o.split(","),l=a.length,n=0,r="";if(angular.forEach(a,function(i){$.trim(i)==$.trim(e[1])&&(r=n),n++}),1==$(this).is(".target-prev"))var d=r-1,m=l-1;else var d=r+1,m=0;if("undefined"!=typeof a[d]&&"null"!=$.trim(a[d]))var c=a[d];else var c=a[m];var _=e[0]+"rooms/"+i+"/"+c;$(".panel-image").removeClass("loading"),$(".listing_slideshow_thumb_view").removeClass("loading"),$("#marker_image_"+i+",#wishlist_image_"+i).attr("src",_)});else{$(this).parent().addClass("loading");var e=s.split("rooms/"+i+"/"),a=o.split(","),l=a.length,n=0,r="";if(angular.forEach(a,function(i){$.trim(i)==$.trim(e[1])&&(r=n),n++}),1==$(this).is(".target-prev"))var d=r-1,m=l-1;else var d=r+1,m=0;if("undefined"!=typeof a[d]&&"null"!=$.trim(a[d]))var c=a[d];else var c=a[m];var _=e[0]+"rooms/"+i+"/"+c;$(".panel-image").removeClass("loading"),$(".listing_slideshow_thumb_view").removeClass("loading"),$("#marker_image_"+i+",#wishlist_image_"+i).attr("src",_)}}),$(".edit-button").click(function(){$(".show_view").hide(),$(".edit_view").show()}),$(".edit_view .cancel").click(function(){$(".show_view").show(),$(".edit_view").hide()}),$(".edit_view .delete").click(function(){confirm("Are you sure?")&&(window.location.href=APP_URL+"/delete_wishlist/"+wishlist_id)}),$(".remove_listing_button").click(function(){$(".wishlist-loading-indicator").show();var i=$(this).data("room_id");t.post(APP_URL+"/remove_saved_wishlist/"+wishlist_id,{room_id:$(this).data("room_id")}).then(function(t){$(".wishlist-loading-indicator").hide(),$("#li_"+i).slideUp(),$("#wishlist_count").text(t.data)})}),$(".note-container").submit(function(i){i.preventDefault(),$(".wishlist-loading-indicator").show(),t.post(APP_URL+"/add_note_wishlist/"+wishlist_id,{room_id:$(this).data("room_id"),note:$("#note_"+$(this).data("room_id")).val()}).then(function(i){$(".wishlist-loading-indicator").hide()})}),$(".share-envelope-btn").click(function(){$(".modal-container").show()}),$(".modal-close").click(function(){$(".modal-container").hide()}),$('[id^="wishlist-widget-icon-"]').click(function(){if("object"==typeof USER_ID)return window.location.href=APP_URL+"/login",!1;var o=$(this).data("name"),s=$(this).data("img"),e=$(this).data("address"),a=$(this).data("host_img");i.room_id=$(this).data("room_id"),$(".background-listing-img").css("background-image","url("+s+")"),$(".host-profile-img").attr("src",a),$(".wl-modal-listing__name").text(o),$(".wl-modal-listing__address").text(e),$(".wl-modal-footer__input").val(e),$(".wl-modal__modal").removeClass("hide"),$(".wl-modal__col:nth-child(2)").addClass("hide"),$(".row-margin-zero").append('<div id="wish-list-signup-container" style="overflow-y:auto;" class="col-lg-5 wl-modal__col-collapsible"> <div class="loading wl-modal__col"> </div> </div>'),t.get(APP_URL+"/wishlist_list?id="+$(this).data("room_id"),{}).then(function(t){$("#wish-list-signup-container").remove(),$(".wl-modal__col:nth-child(2)").removeClass("hide"),i.wishlist_list=t.data})}),i.wishlist_row_select=function(o){t.post(APP_URL+"/save_wishlist",{data:i.room_id,wishlist_id:i.wishlist_list[o].id,saved_id:i.wishlist_list[o].saved_id}).then(function(t){"null"==t.data?i.wishlist_list[o].saved_id=null:i.wishlist_list[o].saved_id=t.data}),$("#wishlist_row_"+o).hasClass("text-dark-gray")?i.wishlist_list[o].saved_id=null:i.wishlist_list[o].saved_id=1},$(document).on("submit",".wl-modal-footer__form",function(o){o.preventDefault(),$(".wl-modal__col:nth-child(2)").addClass("hide"),$(".row-margin-zero").append('<div id="wish-list-signup-container" style="overflow-y:auto;" class="col-lg-5 wl-modal__col-collapsible"> <div class="loading wl-modal__col"> </div> </div>'),t.post(APP_URL+"/wishlist_create",{data:$(".wl-modal-footer__input").val(),id:i.room_id}).then(function(t){$(".wl-modal-footer__form").addClass("hide"),$("#wish-list-signup-container").remove(),$(".wl-modal__col:nth-child(2)").removeClass("hide"),i.wishlist_list=t.data,o.preventDefault()}),o.preventDefault()}),$(".wl-modal__modal-close").click(function(){var t=o("filter")(i.wishlist_list,{saved_id:null});t.length==i.wishlist_list.length?$("#wishlist-widget-"+i.room_id).prop("checked",!1):$("#wishlist-widget-"+i.room_id).prop("checked",!0),$(".wl-modal__modal").addClass("hide"),$(".wl-modal__modal").show()})}]);