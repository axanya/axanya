app.directive("postsPagination",function(){return{restrict:"E",template:'<ul class="pagination"><li ng-show="currentPage != 1"><a href="javascript:void(0)" ng-click="messages_result(1)">&laquo;</a></li><li ng-show="currentPage != 1"><a href="javascript:void(0)" ng-click="messages_result(currentPage-1)">&lsaquo; Prev</a></li><li ng-repeat="i in range" ng-class="{active : currentPage == i}"><a href="javascript:void(0)" ng-click="messages_result(i)">{{i}}</a></li><li ng-show="currentPage != totalPages"><a href="javascript:void(0)" ng-click="messages_result(currentPage+1)">Next &rsaquo;</a></li><li ng-show="currentPage != totalPages"><a href="javascript:void(0)" ng-click="messages_result(totalPages)">&raquo;</a></li></ul>'}}).controller("inbox",["$scope","$http",function(a,e){setTimeout(function(){a.totalPages=0,a.currentPage=1,a.range=[],pageNumber=1,void 0===pageNumber&&(pageNumber="1");var t=$("#inbox_filter_select").val(),n=a.user_id;e.post("inbox/message_by_type",{data:n,type:t}).then(function(e){a.message_result=e.data,a.totalPages=e.data.last_page,a.currentPage=e.data.current_page;for(var t=[],n=1;n<=e.data.last_page;n++)t.push(n);a.range=t}),e.post("inbox/message_count",{data:n,type:t}).then(function(e){a.message_count=e.data}),a.messages_result=function(t){void 0===t&&(t="1");var n=$("#inbox_filter_select").val(),i=a.user_id;e.post("inbox/message_by_type?page="+t,{data:i,type:n}).then(function(e){a.message_result=e.data,a.totalPages=e.data.last_page,a.currentPage=e.data.current_page;for(var t=[],n=1;n<=e.data.last_page;n++)t.push(n);a.range=t})},a.archive=function(t,i,r,s){e.post("inbox/archive",{id:i,msg_id:r,type:s}).then(function(i){"Archive"==s&&(a.message_result.data[t].archive=1),"Unarchive"==s&&(a.message_result.data[t].archive=0),e.post("inbox/message_count",{data:n,type:s}).then(function(e){a.message_count=e.data})})},a.star=function(t,i,r,s){e.post("inbox/star",{id:i,msg_id:r,type:s}).then(function(i){"Star"==s&&(a.message_result.data[t].star=1),"Unstar"==s&&(a.message_result.data[t].star=0),e.post("inbox/message_count",{data:n,type:s}).then(function(e){a.message_count=e.data})})},$("#inbox_filter_select").change(function(){var t=this.value,n=a.user_id;e.post("inbox/message_by_type",{data:n,type:t}).then(function(i){a.message_result=i.data,a.totalPages=i.data.last_page,a.currentPage=i.data.current_page;for(var r=[],s=1;s<=i.data.last_page;s++)r.push(s);a.range=r,e.post("inbox/message_count",{data:n,type:t}).then(function(e){a.message_count=e.data})})})},10)}]),app.controller("conversation",["$scope","$http",function(a,e){function t(a,t,n,i){$(".special-offer-date-fields").addClass("loading"),e.post("../../rooms/price_calculation",{checkin:t,checkout:a,guest_count:n,room_id:i}).then(function(a){$(".special-offer-date-fields").removeClass("loading"),$("#pricing_price").val(a.data.subtotal)})}a.reply_message=function(a){var t=$('[data-key="'+a+'"] textarea[name="message"]').val(),n=$('[data-key="'+a+'"] input[name="template"]').val();e.post(APP_URL+"/messaging/qt_reply/"+$("#reservation_id").val(),{message:t,template:n,pricing_room_id:$("#pricing_room_id").val(),pricing_checkin:$("#pricing_start_date").val(),pricing_checkout:$("#pricing_end_date").val(),pricing_guests:$("#pricing_guests").val(),pricing_price:$("#pricing_price").val()}).then(function(e){$("#thread-list").prepend(e.data),$('[data-key="'+a+'"] textarea[name="message"]').val(""),$(".inquiry-form-fields").addClass("hide"),$('[data-tracking-section="accept"] ul').addClass("hide"),$('[data-tracking-section="decline"] ul').addClass("hide"),$('[data-tracking-section="discussion"] ul').addClass("hide")})},$(document).on("change","#month-dropdown",function(){var a=$(this).val(),t=a.split("-")[0],n=a.split("-")[1],i={};i.month=n,i.year=t,i.reservation_id=$("#reservation_id").val(),i.room_id=$("#hosting").val();var r=JSON.stringify(i);return $("#calendar-container").addClass("loading"),e.post(APP_URL+"/inbox/calendar",{data:r}).then(function(a){$("#calendar-container").removeClass("loading"),$("#calendar-container").html(a.data)}),!1}),$(document).on("click",".nextMonth, .previousMonth",function(){var a=$(this).attr("data-month"),t=$(this).attr("data-year"),n={};n.month=a,n.year=t,n.reservation_id=$("#reservation_id").val(),n.room_id=$("#hosting").val();var i=JSON.stringify(n);return $("#calendar-container").addClass("loading"),e.post(APP_URL+"/inbox/calendar",{data:i}).then(function(a){$("#calendar-container").removeClass("loading"),$("#calendar-container").html(a.data)}),!1}),$(document).on("click","#hosting",function(){var a={},t=$("#month-dropdown").val(),n=t.split("-")[0],i=t.split("-")[1];a.month=i,a.year=n,a.reservation_id=$("#reservation_id").val(),a.room_id=$(this).val();var r=JSON.stringify(a);return $("#calendar-container").addClass("loading"),e.post(APP_URL+"/inbox/calendar",{data:r}).then(function(a){$("#calendar-container").removeClass("loading"),$("#calendar-container").html(a.data)}),$("#edit_calendar_url").attr("href",APP_URL+"/manage-listing/"+$(this).val()+"/calendar"),!1}),$("#month-dropdown").val($("#month-dropdown_value").val()),$("#hosting").val($("#room_id").val()),$(document).on("click",".offer_attach",function(){$(".inquiry-form-fields").removeClass("hide"),$('[data-tracking-section="accept"] ul').removeClass("hide"),$('[data-tracking-section="accept"] input[name="template"][value=2]').prop("checked",!0);var a=$('[data-tracking-section="accept"] input[name="template"]:checked').parent().parent().parent().parent().data("key");$('[data-key="'+a+'"] .drawer').removeClass("hide")}),$(document).on("click",".pre_approve",function(){$(".inquiry-form-fields").removeClass("hide"),$('[data-tracking-section="accept"] ul').removeClass("hide"),$('[data-tracking-section="accept"] input[name="template"][value=1]').prop("checked",!0);var a=$('[data-tracking-section="accept"] input[name="template"]:checked').parent().parent().parent().parent().data("key");$('[data-key="'+a+'"] .drawer').removeClass("hide")}),$(document).on("click",".option-list a",function(){var a=$(this).parent().data("tracking-section");$("[data-tracking-section] ul").addClass("hide"),$('[data-tracking-section="'+a+'"] ul').removeClass("hide");var e=$('[data-tracking-section="'+a+'"] input[name="template"]:checked').parent().parent().parent().parent().data("key");$('[data-key="'+e+'"] .drawer').removeClass("hide")}),$(document).on("click",'input[name="template"]',function(){$("[data-key] .drawer").addClass("hide");var a=$(this).parent().parent().parent().parent().data("key");$('[data-key="'+a+'"] .drawer').removeClass("hide")}),setTimeout(function(){var a=$("#room_id").val(),n=a;e.post("../../rooms/rooms_calendar",{data:a}).then(function(a){var e=(a.data.changed_price,a.data.not_avilable);$("#pricing_start_date").datepicker({minDate:0,dateFormat:"dd-mm-yy",setDate:new Date($("#pricing_start_date").val()),beforeShowDay:function(a){var a=jQuery.datepicker.formatDate("yy-mm-dd",a);return-1!=$.inArray(a,e)?[!1]:[!0]},onSelect:function(a){var e=$("#pricing_start_date").datepicker("getDate");e.setDate(e.getDate()+1),$("#pricing_end_date").datepicker("setDate",e),$("#pricing_end_date").datepicker("option","minDate",e),setTimeout(function(){$("#pricing_end_date").datepicker("show")},20);var i=$(this).val(),e=$("#pricing_end_date").val(),r=$("#pricing_guests").val();t(e,i,r,n),a!=new Date&&$(".ui-datepicker-today").removeClass("ui-datepicker-today")}}),jQuery("#pricing_end_date").datepicker({minDate:1,dateFormat:"dd-mm-yy",setDate:new Date($("#pricing_end_date").val()),beforeShowDay:function(a){var a=jQuery.datepicker.formatDate("yy-mm-dd",a);return-1!=$.inArray(a,e)?[!1]:[!0]},onClose:function(){var a=$("#pricing_start_date").datepicker("getDate"),e=$("#pricing_end_date").datepicker("getDate");if(a>=e){var i=$("#pricing_end_date").datepicker("option","minDate");$("#pricing_end_date").datepicker("setDate",i)}var e=$(this).val(),a=$("#pricing_start_date").val(),r=$("#pricing_guests").val();""!=a&&t(e,a,r,n)}})})},10),$("#pricing_hosting_id").change(function(){var a=$("#pricing_end_date").val(),e=$("#pricing_start_date").val(),n=$("#pricing_guests").val(),i=$(this).val();t(a,e,n,i)})}]);